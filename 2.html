<!DOCTYPE html>
<html>

<head>
    <title>6</title>
    <style>
        *{margin: 0;padding: 0;}
        canvas {
            background-color: black;
        }
    </style>
</head>

<body>
    <canvas id="canvas"></canvas>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        function drawClouds() {
            // 清空画布
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // 创建渐变效果
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, 'rgba(255, 255, 255, 0.2)');
            gradient.addColorStop(1, 'rgba(255, 255, 255, 0)');

            // 绘制云雾效果
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // 添加动画效果
            requestAnimationFrame(drawClouds);
        }

        // 调用函数开始绘制云雾效果
        drawClouds();
        // 创建一个AudioContext对象
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();

        // 加载音频文件
        const audioElement = new Audio('./1.mp3');
        const audioSource = audioContext.createMediaElementSource(audioElement);

        // 创建Analyser节点来获取音频数据
        const analyser = audioContext.createAnalyser();
        audioSource.connect(analyser);
        analyser.connect(audioContext.destination);

        // 设置Analyser节点的参数
        analyser.fftSize = 256;
        const bufferLength = analyser.frequencyBinCount;
        const dataArray = new Uint8Array(bufferLength);

        // 获取音频数据并调整云雾效果的强度
        function updateClouds() {
            analyser.getByteFrequencyData(dataArray);

            // 计算音频数据的平均值
            let average = 0;
            for (let i = 0; i < bufferLength; i++) {
                average += dataArray[i];
            }
            average /= bufferLength;

            // 根据音频数据的平均值来调整云雾效果的强度
            const cloudIntensity = average / 255;

            // 绘制云雾效果
            ctx.fillStyle = `rgba(255, 255, 255, ${cloudIntensity})`;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // 添加动画效果
            requestAnimationFrame(updateClouds);
        }

        // 开始播放音频并调用函数更新云雾效果
        audioElement.play();
        updateClouds();
    </script>
</body>

</html>
